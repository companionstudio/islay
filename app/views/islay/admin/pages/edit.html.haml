- breadcrumb('Pages', :pages)
- breadcrumb(@page.name, @page)
- breadcrumb('Edit')

= resource_form(@page, :url => path(:page, :id => params[:id]), :method => :put) do |f|
  = record_name(@page.name, 'file-text')

  = form_errors(@page)

  = content do
    = f.fieldset('Content', :class => 'form-tab', :id => 'page-content') do
      - @page.each do |slug, type, name, val|
        - if type == :image
          %div.field.single_asset
            = label(name, slug)
            = contents_field(slug, type, val)
        - else
          %div.field
            = label(name, slug)
            = contents_field(slug, type, val)

    - if @page.features?
      - @page.features.build
      = f.fieldset('Features', :class => 'islay-page-features form-tab', :id => 'page-features') do
        = f.fields_for(:features, :include_id => false) do |fe|
          = fe.fieldset(fe.object.title, :class => 'feature') do
            - unless fe.object.errors.blank?
              %p This feature has errors

            = fe.input(:published, :wrapper_html => {:class => 'published-flag'})
            = fe.input(:position, :as => :position)
            = fe.input(:_destroy, :as => :destroy, :label => 'Delete')
            = fe.hidden_field(:id)

            .details
              = fe.input(:title)

              = fe.input(:description, :as => 'text')
              = fe.input(:primary_asset_id, :collection => @assets, :blank => true, :label => 'Image', :as => 'single_asset')
              = fe.input(:secondary_asset_id, :collection => @assets, :blank => true, :label => 'Background', :as => 'single_asset')

              = fe.input(:link_url, :as => 'string')
              = fe.input(:link_title)

  = footer do
    = cancel_button(@page, path(:pages))
    = save_button
